-- Tablas para VenadosRater

-- Tabla de Profesores / Personal
CREATE TABLE public.professors (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    department TEXT,
    role TEXT DEFAULT 'docente', -- 'docente', 'administrativo', 'directivo'
    avatar_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Tabla de Reseñas
CREATE TABLE public.reviews (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    professor_id BIGINT REFERENCES public.professors(id) ON DELETE CASCADE,
    quality INTEGER CHECK (quality >= 1 AND quality <= 5),
    difficulty INTEGER CHECK (difficulty >= 1 AND difficulty <= 5),
    comment TEXT,
    tags TEXT[], -- Array de texto para etiquetas
    created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Habilitar seguridad (RLS)
ALTER TABLE public.professors ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.reviews ENABLE ROW LEVEL SECURITY;

-- Políticas de acceso

-- Cualquiera puede VER profesores y reseñas
CREATE POLICY "Profesores públicos" ON public.professors FOR SELECT USING (true);
CREATE POLICY "Reseñas públicas" ON public.reviews FOR SELECT USING (true);

-- Cualquiera puede CREAR reseñas (Anónimo por ahora)
CREATE POLICY "Crear reseñas anonimas" ON public.reviews FOR INSERT WITH CHECK (true);
